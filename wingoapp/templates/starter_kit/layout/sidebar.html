{% load static %}
{% load sass_tags %}

<style>
/* Enhanced styling untuk History menu */
.nav-submenu a[href*="history"] {
    position: relative;
}

.nav-submenu a[href*="history"]:hover {
    background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%);
    color: white;
    transform: translateX(5px);
    transition: all 0.3s ease;
}

.nav-submenu a[href*="history"].active {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    color: white;
    border-left: 3px solid #28a745;
}

/* Badge styling */
.nav-submenu .badge {
    position: absolute;
    top: 8px;
    right: 10px;
    font-size: 0.7rem;
    padding: 2px 6px;
    border-radius: 10px;
}

.badge-warning {
    background: #ffc107;
    color: #212529;
}

/* Divider styling untuk Review Section */
.nav-divider {
    padding: 10px 15px 5px 15px;
    font-size: 0.75rem;
    font-weight: 600;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-top: 1px solid #e9ecef;
    margin-top: 10px;
}

/* Responsive design */
@media (max-width: 768px) {
    .nav-submenu a[href*="history"]:hover {
        transform: none;
    }
}
</style>
<!-- page sidebar starts -->
<header class="main-nav">
  <div class="logo-wrapper">
    <a href="#"
      ><img
        class="img-fluid"
        src="{% static 'assets/images/logo/logo.png' %}"
        alt=""
    /></a>
  </div>
  <div class="logo-icon-wrapper">
    <a href="#"
      ><img
        class="img-fluid"
        src="{% static 'assets/images/logo/logo-icon.png' %}"
        alt=""
    /></a>
  </div>
  <div class="morden-logo">   
    <a href="#"
      ><img
        class="img-fluid"
        src="{% static 'assets/images/logo/morden-logo.png' %}"
        alt=""
    /></a>
  </div>
  <nav>
    <div class="main-navbar">
      <div class="left-arrow" id="left-arrow">
        <i data-feather="arrow-left"></i>
      </div>
      <div id="mainnav">
        <ul class="nav-menu custom-scrollbar">
          <li class="back-btn">
            <div class="mobile-back text-end">
              <span>Back</span
              ><i class="fa fa-angle-right ps-2" aria-hidden="true"></i>
            </div>
          </li>

          <li>
            <a class="nav-link" href="{% url 'dailyactivity_app:dashboard_index' %}">
              <i data-feather="home"></i><span>Dashboard</span>
            </a>
          </li>

<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">Mechanical</a>
  <ul class="nav-submenu menu-content">
    <li><a href="{% url 'dailyactivity_app:mechanical_index' %}"><i data-feather="tool"></i><span>Mechanical WO</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_mechanical' %}"><i data-feather="tool"></i><span>Data Mechanical WO</span></a></li> 
    <li><a href="{% url 'dailyactivity_app:laporanmechanical_index' %}"><i data-feather="tool"></i><span>Laporan Harian Mechanical</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_laporanmechanical' %}"><i data-feather="tool"></i><span>Data Harian Mechanical</span></a></li>  
    <li><a href="{% url 'dailyactivity_app:schedule_index' %}"><i data-feather="tool"></i><span>Input Jadwal Pekerjaan</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_schedule' %}"><i data-feather="tool"></i><span>Data Jadwal Pekerjaan</span></a></li>
    </ul>
</li>
<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">Electrical</a>

  <ul class="nav-submenu menu-content">
    <li><a href="{% url 'dailyactivity_app:electrical_index' %}"><i data-feather="zap"></i><span>Electrical</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_electrical' %}"><i data-feather="tool"></i><span>Data Electrical</span></a></li>
  </ul>
</li>
<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">Utility</a>
  <ul class="nav-submenu menu-content">
     <li><a href="{% url 'dailyactivity_app:utility_index' %}"><i data-feather="settings"></i><span>Utility</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_utility' %}"><i data-feather="tool"></i><span>Data Utility</span></a></li> 
    <li><a href="{% url 'dailyactivity_app:laporan_index' %}"><i data-feather="tool"></i><span>Laporan Harian Utility</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_laporan' %}"><i data-feather="tool"></i><span>Data Harian Utility</span></a></li>
  </ul>
</li>
<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">It</a>
  <ul class="nav-submenu menu-content">
    <li><a href="{% url 'dailyactivity_app:it_project' %}"><i data-feather="settings"></i><span>It Monitoring</span></a></li>
    <li><a href="{% url 'dailyactivity_app:it_tanggal_project' %}"><i data-feather="settings"></i><span>It Data</span></a></li>
    <li><a href="{% url 'dailyactivity_app:report_data_it' %}"><i data-feather="settings"></i><span>Report IT</span></a></li>
    {% comment %} <li><a href="{% url 'dailyactivity_app:it_index' %}"><i data-feather="settings"></i><span>It</span></a></li>
    <li><a href="{% url 'dailyactivity_app:tanggal_it' %}"><i data-feather="tool"></i><span>Data It</span></a></li> {% endcomment %}
  </ul>
</li>

<!-- ===== TAMBAHAN MENU WO MAINTENANCE ===== -->
{% comment %} <li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">
    <i data-feather="clipboard"></i><span>WO Maintenance</span>
  </a>
  <ul class="nav-submenu menu-content">
    <li><a href="{% url 'wo_maintenance_app:dashboard' %}"><i data-feather="home"></i><span>Dashboard</span></a></li>
    <li><a href="{% url 'wo_maintenance_app:input_laporan' %}"><i data-feather="edit-3"></i><span>Input Laporan</span></a></li>
    <li><a href="{% url 'wo_maintenance_app:daftar_laporan' %}"><i data-feather="list"></i><span>Daftar Pengajuan</span></a></li>
    <li>
      <a href="{% url 'wo_maintenance_app:section_based_daftar_laporan' %}">
        <i data-feather="database"></i><span>Daftar Laporan</span>
      </a>
    </li>
    <li>
      <a href="{% url 'wo_maintenance_app:enhanced_daftar_laporan' %}">
        <i data-feather="star"></i><span>Enhanced View</span>
      </a>
    </li>
  </ul>
</li> {% endcomment %}

<!-- UPDATED WO Maintenance Menu Navigation -->
<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">
    <i data-feather="clipboard"></i><span>WO Maintenance</span>
  </a>
  <ul class="nav-submenu menu-content">
    <!-- Dashboard -->
    <li>
      <a href="{% url 'wo_maintenance_app:dashboard' %}">
        <i data-feather="home"></i><span>Dashboard</span>
      </a>
    </li>
    
    <!-- Input Laporan -->
    <li>
      <a href="{% url 'wo_maintenance_app:input_laporan' %}">
        <i data-feather="edit-3"></i><span>Input Laporan</span>
      </a>
    </li>
    
    
    <li>
      <a href="{% url 'wo_maintenance_app:enhanced_daftar_laporan' %}">
        <i data-feather="star"></i><span>Daftar Pengajuan</span>
      </a>
    </li>

    <!-- NEW: History Pengajuan -->
    <li>       
      <a href="{% url 'wo_maintenance_app:history_pengajuan_list' %}">         
        <i data-feather="archive"></i><span>History Pengajuan</span>       
      </a>     
    </li>

   <!-- NEW: Lihat Monitor - Opens in new tab -->
        <li>
            <a href="{% url 'wo_maintenance_app:monitoring_informasi_system' %}" target="_blank" rel="noopener noreferrer">
                <i data-feather="monitor"></i><span>Lihat Monitor</span>
                <i data-feather="external-link" style="font-size: 12px; margin-left: 5px; opacity: 0.7;"></i>
            </a>
        </li>

    <!-- Divider untuk Review Section (khusus SITI FATIMAH) -->
    {% if user.username == '007522' or employee_data.employee_number == '007522' %}
    <li class="nav-divider">Review System</li>
    
    <!-- Review Dashboard -->
    <li>       
      <a href="{% url 'wo_maintenance_app:review_dashboard' %}">         
        <i data-feather="check-circle"></i><span>Review Dashboard</span>       
      </a>     
    </li>
    
    <!-- Review Pengajuan -->
    <li>       
      <a href="{% url 'wo_maintenance_app:review_pengajuan_list' %}">         
        <i data-feather="clipboard"></i><span>Review Pengajuan</span>       
      </a>     
    </li>
    {% endif %}
    
  </ul> 


{% if perms.dailyactivity_app %}
<li class="dropdown">
  <a class="nav-link menu-title" href="javascript:void(0)">Master Data</a>
  <ul class="nav-submenu menu-content">
              <li><a href="{% url 'dailyactivity_app:shift_index' %}"><i data-feather="clock"></i><span>Shift</span></a></li>
              <li><a href="{% url 'dailyactivity_app:location_index' %}"><i data-feather="map-pin"></i><span>Location</span></a></li>
              <li><a href="{% url 'dailyactivity_app:category_index' %}"><i data-feather="map-pin"></i><span>Category</span></a></li>
              <li><a href="{% url 'dailyactivity_app:status_index' %}"><i data-feather="map-pin"></i><span>Status</span></a></li>
              <li><a href="{% url 'dailyactivity_app:machinemechanical_index' %}"><i data-feather="tool"></i><span>Machine Mechanical</span></a></li>
              <li><a href="{% url 'dailyactivity_app:machineelectrical_index' %}"><i data-feather="zap"></i><span>Machine Electrical</span></a></li>
              <li><a href="{% url 'dailyactivity_app:machineutility_index' %}"><i data-feather="settings"></i><span>Machine Utility</span></a></li>
              <li><a href="{% url 'dailyactivity_app:picmechanical_index' %}"><i data-feather="settings"></i><span>PIC Mechanical</span></a></li>
              <li><a href="{% url 'dailyactivity_app:picelectrical_index' %}"><i data-feather="settings"></i><span>PIC Electrical</span></a></li>
              <li><a href="{% url 'dailyactivity_app:picutility_index' %}"><i data-feather="settings"></i><span>PIC Utility</span></a></li>
              <li><a href="{% url 'dailyactivity_app:picit_index' %}"><i data-feather="settings"></i><span>PIC It</span></a></li>
              <li><a href="{% url 'dailyactivity_app:piclaporan_index' %}"><i data-feather="settings"></i><span>PIC Laporan</span></a></li>
              <li><a href="{% url 'dailyactivity_app:piclembur_index' %}"><i data-feather="settings"></i><span>PIC Lembur</span></a></li>
              <li><a href="{% url 'dailyactivity_app:piclaporanmechanical_index' %}"><i data-feather="settings"></i><span>PIC Laporan Mechanical</span></a></li>
              <li><a href="{% url 'dailyactivity_app:piclemburmechanical_index' %}"><i data-feather="settings"></i><span>PIC Lembur Mechanical</span></a></li>           
  </ul>
</li>
{% endif %}
        </ul>
      </div>
      <div class="right-arrow" id="right-arrow">
        <i data-feather="arrow-right"></i>
      </div>
    </div>

  </nav>
</header>
<!-- page Sidebar Ends-->

<!-- Script untuk highlight active menu -->
<script>
$(document).ready(function() {
    // Get current URL path
    const currentPath = window.location.pathname;
    
    // Remove active class from all menu items
    $('.nav-submenu a').removeClass('active');
    
    // Add active class based on current path
    if (currentPath.includes('/wo-maintenance/')) {
        if (currentPath.includes('/dashboard') || currentPath === '/wo-maintenance/') {
            $('a[href*="dashboard"]').addClass('active');
        } else if (currentPath.includes('/input')) {
            $('a[href*="input_laporan"]').addClass('active');
        } else if (currentPath.includes('/daftar') || currentPath.includes('/list')) {
            $('a[href*="enhanced_daftar_laporan"]').addClass('active');
        } else if (currentPath.includes('/history')) {
            $('a[href*="history_pengajuan_list"]').addClass('active');
        } else if (currentPath.includes('/review')) {
            if (currentPath.includes('/dashboard')) {
                $('a[href*="review_dashboard"]').addClass('active');
            } else {
                $('a[href*="review_pengajuan_list"]').addClass('active');
            }
        }
    }
    
    // Enhanced styling untuk History menu
    $('a[href*="history_pengajuan_list"]').parent().hover(
        function() {
            $(this).find('i').attr('data-feather', 'archive');
            feather.replace();
        },
        function() {
            $(this).find('i').attr('data-feather', 'archive');
            feather.replace();
        }
    );
    
    // Badge notification untuk history items yang perlu attention (optional)
    {% if user.is_authenticated %}
    // Check for open history items
    $.ajax({
        url: '{% url "wo_maintenance_app:ajax_get_history_stats" %}',
        method: 'GET',
        success: function(response) {
            if (response.success && response.stats.open > 0) {
                const badge = `<span class="badge badge-warning">${response.stats.open}</span>`;
                $('a[href*="history_pengajuan_list"] span:first').after(badge);
            }
        },
        error: function() {
            // Silent fail
        }
    });
    {% endif %}
});
</script>

<!-- Optional: JavaScript untuk konfirmasi buka tab baru -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const monitorLink = document.querySelector('a[href*="monitoring_informasi_system"]');
        
        if (monitorLink) {
            monitorLink.addEventListener('click', function(e) {
                // Optional: Add loading indicator atau notification
                console.log('Opening Monitoring System in new tab...');
            });
        }
    });
</script>