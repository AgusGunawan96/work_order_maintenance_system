{% extends 'starter_kit/base.html' %}
{% load static %}
{% load sass_tags %}

{% block css %}
<!-- Plugins css start-->
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/prism.scss' %}">
<link rel="stylesheet" type="text/css" href="{% sass_src 'assets/scss/vendors/datatables.scss' %}">
<!-- Plugins css Ends-->
{% endblock css %}

{% block content %}
<div class="page-body">
{% include 'starter_kit/layout/breadcrumb.html' %}

  <div class="container">
    <div class="card">
      <div class="card-header">
        <h5>IT Project Management - {{ selected_date|date:"d-m-Y" }}</h5>
      </div>
      <div class="card-body">
        <table class="table table-bordered" id="projectsTable">
          <thead>
            <tr>
              <th>No</th>
              <th>Project Name</th>
              <th>PIC</th>
              <th>Issue</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for project_issue in project_issues %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ project_issue.project.project_name }}</td>
              <td>{{ project_issue.project.pic_project }}</td>
              <td>{{ project_issue.issue }}</td>
              <td>
                <a href="{% url 'dailyactivity_app:it_project_detail' project_issue.project.id %}" class="btn btn-primary btn-sm">View Details</a>
                <button class="btn btn-danger btn-sm delete-project" data-id="{{ project_issue.project.id }}">Delete</button>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center">No projects available for this date.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block scriptcontent %}
<!-- Plugins JS start-->
<script src="{% static 'assets/js/prism/prism.min.js' %}"></script>
<script src="{% static 'assets/js/clipboard/clipboard.min.js' %}"></script>
<script src="{% static 'assets/js/custom-card/custom-card.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/js/datatable/datatables/datatable.custom.js' %}"></script>
<!-- Plugins JS Ends-->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Initialize DataTable
    $('#projectsTable').DataTable();
    // Delete project functionality
    document.querySelectorAll('.delete-project').forEach(button => {
      button.addEventListener('click', function () {
        const projectId = this.getAttribute('data-id');
        const row = this.closest('tr');
        
        if (confirm('Are you sure you want to delete this project?')) {
          fetch(`/dailyactivity/it_project/delete/${projectId}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': '{{ csrf_token }}'
            }
          })
            .then(response => {
              if (response.ok) {
                row.remove();
                alert('Project deleted successfully.');
              } else {
                alert('Failed to delete the project.');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('An error occurred while deleting the project.');
            });
        }
      });
    });
  });
</script>
{% endblock scriptcontent %}